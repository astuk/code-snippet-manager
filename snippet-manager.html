<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Snippet Manager - Organize, Store & Share Your Code Snippets</title>
    <meta name="description" content="Free code snippet manager with dark mode, groups, and export features. Organize your JavaScript, Python, PowerShell, and more code snippets efficiently. No signup required.">
    <meta name="keywords" content="code snippet manager, code organizer, snippet storage, developer tools, programming, javascript snippets, python snippets, powershell scripts, code repository, dark mode, free tools">
    <meta name="author" content="Pinnacle Code Tools">
    <meta property="og:title" content="Code Snippet Manager - Your Personal Code Library">
    <meta property="og:description" content="Organize and manage your code snippets with groups, themes, and export features. Free, no signup required.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourwebsite.com/snippet-manager">
    <meta property="og:image" content="https://yourwebsite.com/snippet-manager-preview.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Code Snippet Manager - Organize Your Code">
    <meta name="twitter:description" content="Free code snippet manager with dark mode, groups, and export features. No signup required.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://yourwebsite.com/snippet-manager">
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --bg-header: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-controls: #f8f9fa;
            --bg-snippet: white;
            --bg-code: #f8f9fa;
            --text-primary: #333;
            --text-secondary: #666;
            --text-header: white;
            --border-primary: #dee2e6;
            --border-input: #e0e0e0;
            --border-focus: #667eea;
            --shadow-focus: rgba(102, 126, 234, 0.1);
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            --bg-secondary: rgba(30, 30, 40, 0.95);
            --bg-header: linear-gradient(135deg, #373b44 0%, #4286f4 100%);
            --bg-controls: #1e1e2e;
            --bg-snippet: #2a2a3e;
            --bg-code: #1a1a2e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --text-header: white;
            --border-primary: #3a3a4e;
            --border-input: #3a3a4e;
            --border-focus: #4286f4;
            --shadow-focus: rgba(66, 134, 244, 0.2);
            --accent-primary: #4286f4;
            --accent-secondary: #373b44;
        }

        [data-theme="midnight"] {
            --bg-primary: linear-gradient(135deg, #000428 0%, #004e92 100%);
            --bg-secondary: rgba(10, 20, 40, 0.95);
            --bg-header: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            --bg-controls: #0a1428;
            --bg-snippet: #1a2438;
            --bg-code: #0a1428;
            --text-primary: #c5cae9;
            --text-secondary: #9499b7;
            --text-header: white;
            --border-primary: #283593;
            --border-input: #283593;
            --border-focus: #3949ab;
            --shadow-focus: rgba(57, 73, 171, 0.3);
            --accent-primary: #3949ab;
            --accent-secondary: #1a237e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: var(--bg-header);
            color: var(--text-header);
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .theme-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .controls {
            padding: 30px;
            background: var(--bg-controls);
            border-bottom: 1px solid var(--border-primary);
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input[type="text"], textarea, select {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--border-input);
            border-radius: 10px;
            font-size: 14px;
            background: var(--bg-snippet);
            color: var(--text-primary);
            font-family: 'Consolas', 'Monaco', monospace;
        }

        select {
            min-width: 200px;
            cursor: pointer;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px var(--shadow-focus);
        }

        textarea {
            min-width: 100%;
            max-width: 100%;
            min-height: 80px;
            resize: vertical;
        }

        .group-management {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-snippet);
            border-radius: 10px;
        }

        .group-input {
            flex: 1;
        }

        .group-list {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-code);
            border-radius: 10px;
        }

        .group-list-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .group-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-snippet);
            border: 1px solid var(--border-input);
            border-radius: 20px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .group-item-default {
            opacity: 0.7;
        }

        .btn-delete-group {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
            line-height: 1;
            transition: transform 0.2s;
        }

        .btn-delete-group:hover {
            transform: scale(1.2);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding-left: 40px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        .btn-export {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .btn-export-text {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn-export-text:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(250, 112, 154, 0.4);
        }

        .btn-import {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-edit {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-edit:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(255, 216, 155, 0.4);
        }

        .group-selector {
            padding: 6px 10px;
            border: 2px solid var(--border-input);
            border-radius: 8px;
            background: var(--bg-snippet);
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            min-width: 120px;
        }

        .group-selector:focus {
            outline: none;
            border-color: var(--border-focus);
        }

        .snippet-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .snippet-group-label {
            background: var(--bg-header);
            color: var(--text-header);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .btn-copy {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-copy:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(56, 239, 125, 0.4);
        }

        .btn-copy.copied {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            animation: pulse 0.5s ease;
        }

        .btn-delete {
            background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            color: white;
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-delete:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(252, 70, 107, 0.4);
        }

        .snippets-container {
            padding: 30px;
            max-height: 500px;
            overflow-y: auto;
        }

        .group-section {
            margin-bottom: 30px;
        }

        .group-header {
            background: var(--bg-header);
            color: var(--text-header);
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .group-header:hover {
            opacity: 0.9;
        }

        .group-title {
            font-size: 18px;
            font-weight: 600;
        }

        .group-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 14px;
        }

        .group-snippets {
            padding-left: 20px;
        }

        .group-snippets.collapsed {
            display: none;
        }

        .snippet-item {
            background: var(--bg-snippet);
            border: 1px solid var(--border-input);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        .snippet-item:hover {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .snippet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .snippet-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .snippet-actions {
            display: flex;
            gap: 10px;
        }

        .snippet-code {
            background: var(--bg-code);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            word-break: break-all;
            white-space: pre-wrap;
        }

        .snippet-meta {
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .stats {
            padding: 15px 30px;
            background: var(--bg-controls);
            border-top: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-item {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stat-number {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .edit-mode-indicator {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        .storage-info {
            padding: 10px 30px;
            background: var(--bg-controls);
            border-bottom: 1px solid var(--border-primary);
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        .storage-info code {
            background: var(--bg-code);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .footer {
            padding: 20px 30px;
            background: var(--bg-header);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .footer-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .footer-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .coffee-icon {
            font-size: 18px;
        }

        .feedback-icon {
            font-size: 18px;
        }

        .footer-divider {
            color: rgba(255, 255, 255, 0.5);
            font-size: 20px;
        }

        .disclaimer {
            padding: 15px 30px;
            background: var(--bg-controls);
            border-top: 1px solid var(--border-primary);
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .disclaimer-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 12px;
        }

        .disclaimer a {
            color: var(--accent-primary);
            text-decoration: none;
        }

        .disclaimer a:hover {
            text-decoration: underline;
        }

        .version-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Scrollbar styling */
        .snippets-container::-webkit-scrollbar {
            width: 8px;
        }

        .snippets-container::-webkit-scrollbar-track {
            background: var(--bg-controls);
            border-radius: 10px;
        }

        .snippets-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 10px;
        }

        .snippets-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-secondary) 0%, var(--accent-primary) 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="version-badge">v2.0</div>
            <div class="theme-switcher">
                <label style="color: white; font-size: 14px;">Theme:</label>
                <select class="theme-select" id="themeSelect" onchange="changeTheme()">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="midnight">Midnight</option>
                </select>
            </div>
            <h1>💻 Code Snippet Manager</h1>
            <p>Store, organize, and manage your code snippets efficiently</p>
        </div>

        <div class="storage-info">
            💡 Data is stored in browser localStorage. For backup, regularly export to: 
            <code>%USERPROFILE%\Documents\CodeSnippets\</code> (Windows) or 
            <code>~/Documents/CodeSnippets/</code> (Mac/Linux)
        </div>

        <div class="controls">
            <div id="editIndicator"></div>
            
            <div class="group-management">
                <input type="text" id="newGroupName" placeholder="Create new group..." class="group-input">
                <button class="btn-secondary" onclick="addGroup()">Add Group</button>
                <select id="filterGroup" onchange="filterByGroup()">
                    <option value="">All Groups</option>
                </select>
            </div>
            
            <div class="group-list">
                <div class="group-list-title">Manage Groups (click × to delete):</div>
                <div class="group-items" id="groupList"></div>
            </div>
            
            <div class="bulk-actions">
                <div class="bulk-actions-title">🔄 Bulk Actions:</div>
                <div class="bulk-action-row">
                    <select id="bulkFromGroup">
                        <option value="">From Group...</option>
                        <option value="General">General</option>
                    </select>
                    <span>→</span>
                    <select id="bulkToGroup">
                        <option value="">To Group...</option>
                    </select>
                    <button class="btn-bulk" onclick="bulkMoveSnippets()">Move All Snippets</button>
                    <button class="btn-secondary" onclick="organizeUngrouped()">Organize Ungrouped</button>
                </div>
            </div>

            <div class="input-group">
                <input type="text" id="snippetTitle" placeholder="Snippet title (e.g., 'Array filter')">
                <select id="snippetGroup">
                    <option value="">Select Group...</option>
                </select>
            </div>
            <div class="input-group">
                <textarea id="snippetCode" placeholder="Paste your code snippet here..."></textarea>
            </div>
            <div class="input-group">
                <button class="btn-primary" id="saveBtn" onclick="saveSnippet()">Add Snippet</button>
                <button class="btn-secondary" id="cancelBtn" onclick="cancelEdit()" style="display: none;">Cancel Edit</button>
                <button class="btn-export" onclick="exportSnippets()">📥 Export JSON</button>
                <button class="btn-export-text" onclick="exportAsText()">📄 Export Text</button>
                <button class="btn-import" onclick="document.getElementById('importFile').click()">📤 Import Backup</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importSnippets(event)">
            </div>
            <div class="search-box">
                <span class="search-icon">🔍</span>
                <input type="text" id="searchBox" placeholder="Search snippets..." onkeyup="searchSnippets()">
            </div>
        </div>

        <div class="snippets-container" id="snippetsContainer">
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                <h3>No snippets yet</h3>
                <p>Add your first code snippet to get started!</p>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                Total Snippets: <span class="stat-number" id="totalCount">0</span>
            </div>
            <div class="stat-item">
                Groups: <span class="stat-number" id="groupCount">0</span>
            </div>
            <div class="stat-item">
                Filtered: <span class="stat-number" id="filteredCount">0</span>
            </div>
        </div>

        <div class="footer">
            <a href="https://www.buymeacoffee.com/yourname" target="_blank" rel="noopener noreferrer" class="footer-link" title="Support the development">
                <span class="coffee-icon">☕</span>
                Buy Me a Coffee
            </a>
            <span class="footer-divider">•</span>
            <a href="https://forms.google.com/your-feedback-form" target="_blank" rel="noopener noreferrer" class="footer-link" title="Share your feedback">
                <span class="feedback-icon">📝</span>
                Send Feedback
            </a>
        </div>

        <div class="disclaimer">
            <div class="disclaimer-title">⚠️ DISCLAIMER</div>
            This Code Snippet Manager is provided as a <strong>FREE tool</strong> "AS IS" without any warranties, express or implied. 
            By using this tool, you acknowledge that:
            <br>
            • The developer accepts <strong>NO responsibility</strong> for any data loss, corruption, or security issues
            • All data is stored locally in your browser's localStorage - make regular backups
            • You are solely responsible for the code snippets you store and their usage
            • This tool comes with <strong>NO guarantee</strong> of availability, functionality, or fitness for any purpose
            • The developer is <strong>NOT liable</strong> for any direct, indirect, incidental, or consequential damages
            • You use this tool entirely at your <strong>own risk</strong>
            <br>
            <strong>Always maintain backups of important code snippets.</strong> 
            This is a hobby project provided free of charge with no support obligations.
        </div>
    </div>

    <script>
        // Store snippets and groups in memory
        let snippets = [];
        let groups = ['General', 'JavaScript', 'Python', 'HTML/CSS', 'SQL', 'React', 'Node.js', 
                     'Qualys', 'PowerShell', 'Windows Admin', 'Network/Security', 'Linux/Bash', 'Data/Excel'];
        let defaultGroups = ['General']; // Groups that cannot be deleted
        let filteredSnippets = [];
        let editingSnippetId = null;
        let currentTheme = 'light';

        // Load data from localStorage on page load
        window.onload = function() {
            // Load theme
            const savedTheme = localStorage.getItem('snippetManagerTheme') || 'light';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeSelect').value = savedTheme;

            // Load snippets
            try {
                const storedSnippets = localStorage.getItem('codeSnippets');
                if (storedSnippets) {
                    snippets = JSON.parse(storedSnippets);
                }

                const storedGroups = localStorage.getItem('codeGroups');
                if (storedGroups) {
                    groups = JSON.parse(storedGroups);
                }
            } catch (e) {
                console.log('Note: Data persists in localStorage. For backups, export regularly.');
            }

            updateGroupSelects();
            updateGroupList();
            displaySnippets();
            
            // Check for ungrouped snippets
            const ungroupedCount = snippets.filter(s => !s.group || s.group === '').length;
            if (ungroupedCount > 0) {
                setTimeout(() => {
                    alert(`ℹ️ Found ${ungroupedCount} snippet(s) without groups.\n\nUse the "Organize Ungrouped" button to assign them to a group, or use the dropdown on each snippet to assign groups individually.`);
                }, 500);
            }
        };

        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('snippetManagerTheme', theme);
        }

        function saveToStorage() {
            try {
                localStorage.setItem('codeSnippets', JSON.stringify(snippets));
                localStorage.setItem('codeGroups', JSON.stringify(groups));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }

        function addGroup() {
            const groupName = document.getElementById('newGroupName').value.trim();
            if (!groupName) {
                alert('Please enter a group name');
                return;
            }

            if (groups.includes(groupName)) {
                alert('Group already exists');
                return;
            }

            groups.push(groupName);
            saveToStorage();
            updateGroupSelects();
            updateGroupList();
            document.getElementById('newGroupName').value = '';
        }

        function deleteGroup(groupName) {
            if (defaultGroups.includes(groupName)) {
                alert('Cannot delete the default "General" group');
                return;
            }

            const snippetsInGroup = snippets.filter(s => s.group === groupName);
            
            let confirmMessage = `Delete group "${groupName}"?`;
            if (snippetsInGroup.length > 0) {
                confirmMessage += `\n\nThis group contains ${snippetsInGroup.length} snippet(s).\nThey will be moved to the "General" group.`;
            }

            if (confirm(confirmMessage)) {
                // Move all snippets from this group to General
                snippets = snippets.map(s => {
                    if (s.group === groupName) {
                        return { ...s, group: 'General' };
                    }
                    return s;
                });

                // Remove the group
                groups = groups.filter(g => g !== groupName);
                
                saveToStorage();
                updateGroupSelects();
                updateGroupList();
                displaySnippets();
            }
        }

        function updateGroupList() {
            const groupListEl = document.getElementById('groupList');
            
            groupListEl.innerHTML = groups.map(group => {
                const isDefault = defaultGroups.includes(group);
                const count = snippets.filter(s => s.group === group).length;
                
                return `
                    <div class="group-item ${isDefault ? 'group-item-default' : ''}">
                        <span>${escapeHtml(group)} (${count})</span>
                        ${!isDefault ? `<button class="btn-delete-group" onclick="deleteGroup('${escapeHtml(group)}')" title="Delete group">×</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateGroupSelects() {
            const snippetGroupSelect = document.getElementById('snippetGroup');
            const filterGroupSelect = document.getElementById('filterGroup');
            const bulkFromSelect = document.getElementById('bulkFromGroup');
            const bulkToSelect = document.getElementById('bulkToGroup');

            // Update snippet group select
            snippetGroupSelect.innerHTML = '<option value="">Select Group...</option>';
            groups.forEach(group => {
                snippetGroupSelect.innerHTML += `<option value="${escapeHtml(group)}">${escapeHtml(group)}</option>`;
            });

            // Update filter group select
            const currentFilter = filterGroupSelect.value;
            filterGroupSelect.innerHTML = '<option value="">All Groups</option>';
            groups.forEach(group => {
                filterGroupSelect.innerHTML += `<option value="${escapeHtml(group)}">${escapeHtml(group)}</option>`;
            });
            filterGroupSelect.value = currentFilter;
            
            // Update bulk action selects
            bulkFromSelect.innerHTML = '<option value="">From Group...</option><option value="ungrouped">⚠️ Ungrouped/Missing</option>';
            groups.forEach(group => {
                const count = snippets.filter(s => s.group === group).length;
                bulkFromSelect.innerHTML += `<option value="${escapeHtml(group)}">${escapeHtml(group)} (${count})</option>`;
            });
            
            bulkToSelect.innerHTML = '<option value="">To Group...</option>';
            groups.forEach(group => {
                bulkToSelect.innerHTML += `<option value="${escapeHtml(group)}">${escapeHtml(group)}</option>`;
            });
            
            // Update the group list display
            updateGroupList();
        }

        function bulkMoveSnippets() {
            const fromGroup = document.getElementById('bulkFromGroup').value;
            const toGroup = document.getElementById('bulkToGroup').value;
            
            if (!fromGroup || !toGroup) {
                alert('Please select both source and destination groups');
                return;
            }
            
            if (fromGroup === toGroup) {
                alert('Source and destination groups must be different');
                return;
            }
            
            let affectedSnippets;
            if (fromGroup === 'ungrouped') {
                affectedSnippets = snippets.filter(s => !s.group || s.group === '');
            } else {
                affectedSnippets = snippets.filter(s => s.group === fromGroup);
            }
            
            if (affectedSnippets.length === 0) {
                alert('No snippets found in the selected source group');
                return;
            }
            
            if (confirm(`Move ${affectedSnippets.length} snippet(s) from "${fromGroup}" to "${toGroup}"?`)) {
                snippets = snippets.map(snippet => {
                    if (fromGroup === 'ungrouped' ? (!snippet.group || snippet.group === '') : (snippet.group === fromGroup)) {
                        return {
                            ...snippet,
                            group: toGroup,
                            updatedAt: new Date().toLocaleString()
                        };
                    }
                    return snippet;
                });
                
                saveToStorage();
                updateGroupSelects();
                displaySnippets();
                
                alert(`Successfully moved ${affectedSnippets.length} snippet(s) to "${toGroup}"`);
            }
        }

        function organizeUngrouped() {
            const ungroupedSnippets = snippets.filter(s => !s.group || s.group === '');
            
            if (ungroupedSnippets.length === 0) {
                alert('No ungrouped snippets found! All snippets are already organized.');
                return;
            }
            
            if (confirm(`Found ${ungroupedSnippets.length} ungrouped snippet(s).\n\nMove them all to "General" group?`)) {
                snippets = snippets.map(snippet => {
                    if (!snippet.group || snippet.group === '') {
                        return {
                            ...snippet,
                            group: 'General',
                            updatedAt: new Date().toLocaleString()
                        };
                    }
                    return snippet;
                });
                
                saveToStorage();
                updateGroupSelects();
                displaySnippets();
                
                alert(`Successfully organized ${ungroupedSnippets.length} snippet(s) into "General" group`);
            }
        }

        function saveSnippet() {
            const title = document.getElementById('snippetTitle').value.trim();
            const code = document.getElementById('snippetCode').value.trim();
            const group = document.getElementById('snippetGroup').value;

            if (!title || !code) {
                alert('Please enter both a title and code snippet');
                return;
            }

            if (editingSnippetId) {
                // Update existing snippet
                const index = snippets.findIndex(s => s.id === editingSnippetId);
                if (index !== -1) {
                    snippets[index] = {
                        ...snippets[index],
                        title: title,
                        code: code,
                        group: group || 'General',
                        updatedAt: new Date().toLocaleString()
                    };
                }
                cancelEdit();
            } else {
                // Add new snippet
                const snippet = {
                    id: Date.now(),
                    title: title,
                    code: code,
                    group: group || 'General',
                    createdAt: new Date().toLocaleString(),
                    updatedAt: new Date().toLocaleString()
                };
                snippets.unshift(snippet);
            }

            saveToStorage();
            displaySnippets();

            // Clear inputs
            document.getElementById('snippetTitle').value = '';
            document.getElementById('snippetCode').value = '';
            document.getElementById('snippetGroup').value = '';

            // Show success animation
            const container = document.getElementById('snippetsContainer');
            container.scrollTop = 0;
        }

        function quickChangeGroup(snippetId, newGroup) {
            const index = snippets.findIndex(s => s.id === snippetId);
            if (index !== -1) {
                snippets[index].group = newGroup;
                snippets[index].updatedAt = new Date().toLocaleString();
                saveToStorage();
                displaySnippets();
                
                // Show brief success feedback
                const selector = event.target;
                const originalBg = selector.style.background;
                selector.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                setTimeout(() => {
                    selector.style.background = originalBg;
                }, 500);
            }
        }

        function editSnippet(id) {
            const snippet = snippets.find(s => s.id === id);
            if (!snippet) return;

            editingSnippetId = id;

            // Populate form with snippet data
            document.getElementById('snippetTitle').value = snippet.title;
            document.getElementById('snippetCode').value = snippet.code;
            document.getElementById('snippetGroup').value = snippet.group || 'General';

            // Update UI to show edit mode
            document.getElementById('saveBtn').textContent = 'Update Snippet';
            document.getElementById('cancelBtn').style.display = 'inline-block';
            document.getElementById('editIndicator').innerHTML = '<div class="edit-mode-indicator">📝 Editing Snippet</div>';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelEdit() {
            editingSnippetId = null;
            document.getElementById('saveBtn').textContent = 'Add Snippet';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('editIndicator').innerHTML = '';
            
            // Clear form
            document.getElementById('snippetTitle').value = '';
            document.getElementById('snippetCode').value = '';
            document.getElementById('snippetGroup').value = '';
        }

        function deleteSnippet(id) {
            if (confirm('Are you sure you want to delete this snippet?')) {
                snippets = snippets.filter(s => s.id !== id);
                saveToStorage();
                displaySnippets();
            }
        }

        function copySnippet(id, button) {
            const snippet = snippets.find(s => s.id === id);
            if (snippet) {
                navigator.clipboard.writeText(snippet.code).then(() => {
                    const originalText = button.innerText;
                    button.innerText = 'Copied!';
                    button.classList.add('copied');
                    
                    setTimeout(() => {
                        button.innerText = originalText;
                        button.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    alert('Failed to copy: ' + err);
                });
            }
        }

        function toggleGroup(groupName) {
            const groupElement = document.querySelector(`[data-group="${groupName}"]`);
            if (groupElement) {
                groupElement.classList.toggle('collapsed');
            }
        }

        function filterByGroup() {
            const selectedGroup = document.getElementById('filterGroup').value;
            
            if (selectedGroup) {
                filteredSnippets = snippets.filter(s => s.group === selectedGroup);
            } else {
                filteredSnippets = snippets;
            }
            
            displaySnippets(filteredSnippets);
        }

        function searchSnippets() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const selectedGroup = document.getElementById('filterGroup').value;
            
            let searchBase = selectedGroup ? 
                snippets.filter(s => s.group === selectedGroup) : 
                snippets;
            
            if (searchTerm) {
                filteredSnippets = searchBase.filter(s => 
                    s.title.toLowerCase().includes(searchTerm) || 
                    s.code.toLowerCase().includes(searchTerm) ||
                    (s.group && s.group.toLowerCase().includes(searchTerm))
                );
            } else {
                filteredSnippets = searchBase;
            }
            
            displaySnippets(filteredSnippets);
        }

        function displaySnippets(snippetsToShow = snippets) {
            const container = document.getElementById('snippetsContainer');
            
            if (snippetsToShow.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <h3>${snippets.length === 0 ? 'No snippets yet' : 'No matching snippets'}</h3>
                        <p>${snippets.length === 0 ? 'Add your first code snippet to get started!' : 'Try a different search term or filter'}</p>
                    </div>
                `;
            } else {
                // Group snippets
                const grouped = {};
                snippetsToShow.forEach(snippet => {
                    const group = snippet.group || 'General';
                    if (!grouped[group]) {
                        grouped[group] = [];
                    }
                    grouped[group].push(snippet);
                });

                let html = '';
                Object.keys(grouped).sort().forEach(group => {
                    html += `
                        <div class="group-section">
                            <div class="group-header" onclick="toggleGroup('${escapeHtml(group)}')">
                                <div class="group-title">📁 ${escapeHtml(group)}</div>
                                <div class="group-count">${grouped[group].length} snippets</div>
                            </div>
                            <div class="group-snippets" data-group="${escapeHtml(group)}">
                    `;

                    grouped[group].forEach(snippet => {
                        const groupOptions = groups.map(g => 
                            `<option value="${escapeHtml(g)}" ${g === (snippet.group || 'General') ? 'selected' : ''}>${escapeHtml(g)}</option>`
                        ).join('');

                        html += `
                            <div class="snippet-item">
                                <div class="snippet-info">
                                    <span class="snippet-group-label">📁 ${escapeHtml(snippet.group || 'General')}</span>
                                    <select class="group-selector" onchange="quickChangeGroup(${snippet.id}, this.value)" title="Move to group">
                                        ${groupOptions}
                                    </select>
                                </div>
                                <div class="snippet-header">
                                    <div class="snippet-title">${escapeHtml(snippet.title)}</div>
                                    <div class="snippet-actions">
                                        <button class="btn-edit" onclick="editSnippet(${snippet.id})">Edit</button>
                                        <button class="btn-copy" onclick="copySnippet(${snippet.id}, this)">Copy</button>
                                        <button class="btn-delete" onclick="deleteSnippet(${snippet.id})">Delete</button>
                                    </div>
                                </div>
                                <div class="snippet-code">${escapeHtml(snippet.code)}</div>
                                <div class="snippet-meta">
                                    Created: ${snippet.createdAt} 
                                    ${snippet.updatedAt && snippet.updatedAt !== snippet.createdAt ? 
                                        `| Updated: ${snippet.updatedAt}` : ''}
                                </div>
                            </div>
                        `;
                    });

                    html += `
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            // Update stats
            document.getElementById('totalCount').textContent = snippets.length;
            document.getElementById('groupCount').textContent = groups.length;
            document.getElementById('filteredCount').textContent = snippetsToShow.length;
        }

        function exportSnippets() {
            if (snippets.length === 0) {
                alert('No snippets to export!');
                return;
            }

            const exportData = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                snippets: snippets,
                groups: groups,
                theme: currentTheme
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            
            const date = new Date().toISOString().split('T')[0];
            link.download = `code-snippets-backup-${date}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            const button = event.target;
            const originalText = button.innerText;
            button.innerText = '✅ Exported!';
            setTimeout(() => {
                button.innerText = originalText;
            }, 2000);
        }

        function exportAsText() {
            if (snippets.length === 0) {
                alert('No snippets to export!');
                return;
            }

            let textContent = `CODE SNIPPETS BACKUP\n`;
            textContent += `Exported: ${new Date().toLocaleString()}\n`;
            textContent += `Total Snippets: ${snippets.length}\n`;
            textContent += `Groups: ${groups.join(', ')}\n`;
            textContent += `${'='.repeat(50)}\n\n`;

            // Group snippets for text export
            const grouped = {};
            snippets.forEach(snippet => {
                const group = snippet.group || 'General';
                if (!grouped[group]) {
                    grouped[group] = [];
                }
                grouped[group].push(snippet);
            });

            Object.keys(grouped).sort().forEach(group => {
                textContent += `\n[GROUP: ${group}]\n`;
                textContent += `${'='.repeat(30)}\n\n`;

                grouped[group].forEach((snippet, index) => {
                    textContent += `Title: ${snippet.title}\n`;
                    textContent += `Created: ${snippet.createdAt || 'Unknown'}\n`;
                    if (snippet.updatedAt && snippet.updatedAt !== snippet.createdAt) {
                        textContent += `Updated: ${snippet.updatedAt}\n`;
                    }
                    textContent += `Code:\n${'-'.repeat(30)}\n`;
                    textContent += `${snippet.code}\n`;
                    textContent += `${'-'.repeat(30)}\n\n`;
                });
            });

            const dataBlob = new Blob([textContent], { type: 'text/plain' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            
            const date = new Date().toISOString().split('T')[0];
            link.download = `code-snippets-text-${date}.txt`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            const button = event.target;
            const originalText = button.innerText;
            button.innerText = '✅ Exported!';
            setTimeout(() => {
                button.innerText = originalText;
            }, 2000);
        }

        function importSnippets(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    // Check if it's the new format with groups
                    let importedSnippets = [];
                    let importedGroups = [];
                    
                    if (imported.version === '2.0') {
                        importedSnippets = imported.snippets || [];
                        importedGroups = imported.groups || [];
                    } else if (Array.isArray(imported)) {
                        // Old format - just an array of snippets
                        importedSnippets = imported;
                    } else {
                        throw new Error('Invalid file format');
                    }
                    
                    // Ask user how to handle import
                    const choice = confirm(
                        `Found ${importedSnippets.length} snippets and ${importedGroups.length} groups in the backup.\n\n` +
                        `Click OK to MERGE with existing data (${snippets.length} current snippets)\n` +
                        `Click Cancel to REPLACE all existing data`
                    );
                    
                    if (choice) {
                        // Merge
                        const existingIds = new Set(snippets.map(s => s.id));
                        const newSnippets = importedSnippets.filter(s => !existingIds.has(s.id));
                        snippets = [...snippets, ...newSnippets];
                        
                        // Merge groups
                        importedGroups.forEach(group => {
                            if (!groups.includes(group)) {
                                groups.push(group);
                            }
                        });
                        
                        alert(`Merged successfully! Added ${newSnippets.length} new snippets.`);
                    } else {
                        // Replace
                        const oldCount = snippets.length;
                        snippets = importedSnippets;
                        if (importedGroups.length > 0) {
                            groups = importedGroups;
                        }
                        alert(`Replaced ${oldCount} snippets with ${importedSnippets.length} from backup.`);
                    }
                    
                    saveToStorage();
                    updateGroupSelects();
                    displaySnippets();
                    
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Allow adding snippet with Ctrl+Enter in textarea
        document.getElementById('snippetCode').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                saveSnippet();
            }
        });
    </script>
</body>
</html>